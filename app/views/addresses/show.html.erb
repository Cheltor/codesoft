<% content_for :title, @address.combadd %>

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="#">
      <%= link_to "Home", root_path %>
    </a></li>
    <li class="breadcrumb-item active"><a href="#">
    <%= link_to @address.combadd, address_path(@address) %>
    </a></li>
  </ol>
</nav>

<div class="row">
  <div class="col-sm-4">
    <div class="card">
      <div class="card-body">
        <h2><%= @address.combadd %>            <a href="https://www.google.com/maps/search/?api=1&query=<%= @address.combadd %>+MD+<%= @address.premisezip %>" target="_blank" class="btn btn-secondary">
        <i class="bi bi-geo-alt-fill"></i></a></h2>
        <br>
            <h4>Owner:</h4>
    <p><%= @address.ownername.titleize %></p>
    <h4>Owner Address:</h4>
    <p><%= @address.owneraddress %> <%= @address.ownercity %>, <%= @address.ownerstate %> <%= @address.ownerzip %></p>

    <!-- Button trigger modal -->
    <button type="button" class="btn btn-secondary mt-2 mb-3" data-bs-toggle="modal" data-bs-target="#exampleModal">
      Update Owner/Address
    </button>

    <!-- link to create a new business -->
    <%= link_to "Add Business", new_address_business_path(@address), class: "btn btn-info mt-2 mb-3", data: { turbo: false } %>

    <!-- show any associated businesses -->
    <% if @address.businesses.present? %>
    <div class="accordion mt-2 mb-2" id="accordionExample">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBusiness" aria-expanded="false" aria-controls="collapseOne">
            <i class="bi bi-chevron-down"></i>  Show <%= pluralize(@address.businesses.count, "Business") %>
          </button>
        </h2>
        <div id="collapseBusiness" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
          <div class="accordion-body">
            <% @address.businesses.each do |business| %>
              <%= link_to business.name, address_business_path(@address, business) %>
              <br>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <% end %>


    <!-- add associated contacts 
    <%= link_to 'Manage Contacts', manage_contacts_address_path(@address), class: "btn btn-secondary mt-2 mb-3", data: { turbo: false } %>-->

        <% if @address.contacts.present? %>
        <div class="accordion mt-2 mb-2" id="accordionExample">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseContact" aria-expanded="false" aria-controls="collapseOne">
                <i class="bi bi-chevron-down"></i>  Show <%= pluralize(@address.contacts.count, "Contact") %>
              </button>
            </h2>
            <div id="collapseContact" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
              <div class="accordion-body">
                <% @address.contacts.each do |contact| %>
                  <p><%= link_to contact.name, contact_path(contact) %> - <a href="tel:<%= contact.phone %>"><%= format_phone_number(contact.phone) %></a> - <%= link_to contact.email, "mailto:#{contact.email}" %></p>
                <% end %>
              </div>
            </div>
          </div>
        </div>
        <% end %>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Are you sure?</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Be careful when updating the address information.
            
          </div>
          <div class="modal-footer">
            <%= link_to "Update", edit_address_path(@address), class: "btn btn-primary" %>
          </div>
        </div>
      </div>
    </div>
      </div>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="card shadow" style="background-color: #e3f2fd;">
      <div class="card-body">
        <%= render 'comments/form' %>
      </div>
    </div>
  </div>
  <div class="col-sm-4 text-center">
    <div class="card">
      <div class="card-body">
          <% if @address_photos.any? %>
          <button type="button" class="btn btn-outline-secondary btn-lg" data-bs-toggle="modal" data-bs-target="#allphotoModal">
            <i class="bi bi-paperclip"></i>
            All Photos and Attachments
          </button>
          <% end %>
          <% if current_user.ons? %>
            <% if @is_priority_address %>
              <%= button_to mark_reviewed_path(@address.id), method: :patch, class: "btn btn-outline-primary mt-2", data: { turbolinks: false } do %>
                Mark as Reviewed <i class="bi bi-check-lg"></i>
              <% end %>
            <% else %>
              <p>This is not a priority address.</p>
            <% end %>
          <% end %>
            <%= link_to "Create a Violation Notice/Doorhanger", new_address_violation_path(@address), class: "btn btn-outline-danger btn-lg mt-2", data: { turbo: false } %>
            <br>
            <%= link_to "Create New Inspection Request", new_address_inspection_path(@address), class: "btn btn-outline-info btn-lg mt-2", data: { turbo: false } %>
            <br>
            <%= link_to "Add Units", new_address_unit_path(@address), class: "btn btn-outline-secondary btn-lg mt-2" %>
            <br>
            <!-- add contacts -->

        <!-- bootstrap collapse listing a link to all units -->

        <% if @address.units.present? %>
        <div class="accordion mt-2 mb-2" id="accordionExample">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                <i class="bi bi-chevron-down"></i>  Show <%= pluralize(@address.units.count, "Unit") %>
              </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
              <div class="accordion-body">
                <% @address.units.each do |unit| %>
                  <%= link_to unit.number.upcase, address_unit_path(@address, unit) %>
                  <br>
                <% end %>
              </div>
            </div>
          </div>
        </div>
        <% end %>
      </div>
    </div>  
  </div>
</div>
<div class="row">
  <div class="col-sm-4">

    <!-- button to add units -->
    <br>
    
    <!-- 
    <% if @address.units.present? || @unit.present? %>
      <%= link_to "Create Business", new_address_business_path(@address), class: "btn btn-primary mt-2 mb-2" %>
    <% end %>
    -->

    <!--
    <br>
    <a href="https://sdat.dat.maryland.gov/RealProperty/Pages" target="_blank" class="btn btn-secondary">
      <i class="bi bi-building"></i> SDAT Property Search
    </a> -->

    <!-- Modal -->
    <div class="modal fade custom-modal-lg" id="allphotoModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            All Attachments
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <% @address_photos.each do |photo| %>
              <%= render partial: "shared/show_image", locals: { photo: photo } %>
            <% end %>
          </div>
        </div>
      </div>
    </div>


  </div>
  <div class="col-sm-4">

  </div>
  <div class="col-sm-4">

  </div>
</div>
<div class="row mt-5">
  <div class="col">
    <nav class="nav nav-pills nav-fill">
      <a class="nav-item nav-link active" href="#" data-bs-toggle="tab" data-bs-target="#comment">
        <i class="bi bi-chat-dots"></i> <%= pluralize(@address.comments.count, "Comment") %>
      </a>
      <a class="nav-item nav-link" href="#" data-bs-toggle="tab" data-bs-target="#violation">
        <i class="bi bi-exclamation-triangle-fill"></i> <%= pluralize(@address.violations.count, "Violation") %>
      </a>
      <a class="nav-item nav-link" href="#" data-bs-toggle="tab" data-bs-target="#citation">
        <i class="bi bi-file-earmark-text-fill"></i> <%= pluralize(@address_citations.count, "Citation") %>
      </a>
      <a class="nav-item nav-link " href="#" data-bs-toggle="tab" data-bs-target="#inspection">
        <i class="bi bi-clipboard-check"></i> <%= pluralize(@address.inspections.where(unit: nil).count, "Inspection") %> 
      </a>
    </nav>

    <div class="tab-content">
      <div class="tab-pane fade show active" id="comment">
      <br>
        <% @address.comments.order("created_at DESC").each do |comment| %>
          <%= render 'comments/comments', comment: comment, show_address_info: false, show_edit_link: true, show_unit_info: false %>
        <% end %>
      </div>
      <div class="tab-pane fade " id="violation">
    <div style="text-align: center">
      <%= link_to "Create a Violation Notice/Doorhanger", new_address_violation_path(@address), class: "btn btn-danger btn-lg mt-5", data: { turbo: false } %>
    </div>
    <br>
    <% if @address.violations.any? %>
    <div class="table-responsive" style="text-align: center">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th scope="col">Address</th>
            <th scope="col">Created By</th>
            <th scope="col">Created At</th>
            <th scope="col">Violation Type</th>
            <th scope="col">Code</th>
            <th scope="col">Deadline Date</th>
            <th scope="col">Citations</th>
          </tr>
        </thead>
        <tbody>
          <% @address.violations.order("created_at DESC").each do |violation| %>
            <%= render partial: "shared/violation_table", locals: {violation: violation} %>
          <% end %>
        </tbody>
      </table>
    </div>
    <% else %>
    <p style="text-align: center">No violations have been created for this address.</p>
    <% end %>
      </div>
      <div class="tab-pane fade " id="citation">
    <% if @address_citations.any? %>
    <div class="table-responsive" style="text-align: center">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th scope="col">Citation ID</th>
            <th scope="col">Address</th>
            <th scope="col">Created By</th>
            <th scope="col">Created At</th>
            <th scope="col">Fine</th>
            <th scope="col">Status</th>
            <th scope="col">Code</th>
            <th scope="col">Deadline Date</th>
          </tr>
        </thead>
        <tbody>
          <% @address_citations.each do |citation| %>
            <%= render partial: "shared/citation_table", locals: {citation: citation} %>
          <% end %>
        </tbody>
      </table>
    </div>
    <% end %>
    </div>
      <div class="tab-pane fade" id="inspection">
        <div style="text-align: center">
            <%= link_to "Create New Inspection", new_address_inspection_path(@address), class: "btn btn-primary btn-lg mt-5", data: { turbo: false } %>
        </div>
        <br>
        <% if @address.inspections.any? %>
        <div class="table-responsive" style="text-align: center">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th scope="col">Created At</th>
                <th scope="col">Source</th>
                <th scope="col">Status</th>
                <th scope="col">Scheduled Date</th>
                <th scope="col">Inspector</th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody>
              <% @address.inspections.where(unit: nil).order("updated_at DESC").each do |inspection| %>
                <%= render partial: "shared/inspection_table2", locals: {inspection: inspection} %>
              <% end %>
            </tbody>
          </table>
        </div>
        <% else %>
        <p style="text-align: center">No inspections have been created for this address.</p>
        <% end %>
      </div>
  </div>
</div>
<div class="row">
  <div class="col">

  </div>
  <div class="col mt-5">
    

  </div>
</div>
