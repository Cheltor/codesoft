<% content_for :title, @address.property_name_with_combadd %>

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="#">
      <%= link_to "Home", root_path %>
    </a></li>
    <li class="breadcrumb-item active"><a href="#">
    <%= link_to @address.property_name_with_combadd, address_path(@address) %>
    </a></li>
  </ol>
</nav>

<div class="row">
  <%= render 'shared/address_info' %>
  <%= render 'addresses/timeline' %>
</div>

<div class="row">
  <div class="col-sm-4">

    <!-- button to add units -->
    <br>
    
    <!-- 
    <% if @address.units.present? || @unit.present? %>
      <%= link_to "Create Business", new_address_business_path(@address), class: "btn btn-primary mt-2 mb-2" %>
    <% end %>
    -->

    <!--
    <br>
    <a href="https://sdat.dat.maryland.gov/RealProperty/Pages" target="_blank" class="btn btn-secondary">
      <i class="bi bi-building"></i> SDAT Property Search
    </a> -->

    <!-- Modal -->
    <div class="modal fade custom-modal-lg" id="allphotoModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            All Attachments
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <% @address_photos.each do |photo| %>
              <%= render partial: "shared/show_image", locals: { photo: photo } %>
            <% end %>
          </div>
        </div>
      </div>
    </div>


  </div>
  <div class="col-sm-4">

  </div>
  <div class="col-sm-4">

  </div>
</div>
<div class="row mt-5">
  <div class="col">
    <nav class="nav nav-pills nav-fill">
      <a class="nav-item nav-link active" href="#" data-bs-toggle="tab" data-bs-target="#comment">
        <i class="bi bi-chat-dots"></i> <%= pluralize(@address.comments.count, "Comment") %>
      </a>
      <a class="nav-item nav-link" href="#" data-bs-toggle="tab" data-bs-target="#violation">
        <i class="bi bi-exclamation-triangle-fill"></i> <%= pluralize(@address.violations.count, "Violation") %>
      </a>
      <a class="nav-item nav-link" href="#" data-bs-toggle="tab" data-bs-target="#citation">
        <i class="bi bi-file-earmark-text-fill"></i> <%= pluralize(@address_citations.count, "Citation") %>
      </a>
      <a class="nav-item nav-link " href="#" data-bs-toggle="tab" data-bs-target="#inspection">
        <i class="bi bi-clipboard-check"></i> <%= pluralize(@address.inspections.where(unit: nil).count, "Inspection") %> 
      </a>
      <a class="nav-item nav-link " href="#" data-bs-toggle="tab" data-bs-target="#complaint">
        <i class="bi bi-exclamation-circle-fill"></i> <%= pluralize(@address.inspections.where(source: "Complaint").count, "Complaint") %>
      </a>
    </nav>

    <div class="tab-content">
      <div class="tab-pane fade show active" id="comment">
      <br>
        <% @address.comments.order("created_at DESC").each do |comment| %>
          <%= render 'comments/comments', comment: comment, show_address_info: false, show_edit_link: true, show_unit_info: false %>
        <% end %>
      </div>
      <div class="tab-pane fade " id="violation">
        <div style="text-align: center">
          <%= link_to "Create a Violation Notice/Doorhanger", new_address_violation_path(@address), class: "btn btn-danger btn-lg mt-5", data: { turbo: false } %>
        </div>
        <br>
        <% if @address.violations.any? %>
        <div class="table-responsive" style="text-align: center">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th scope="col">Address</th>
                <th scope="col">Created By</th>
                <th scope="col">Created At</th>
                <th scope="col">Violation Type</th>
                <th scope="col">Code</th>
                <th scope="col">Deadline Date</th>
                <th scope="col">Citations</th>
              </tr>
            </thead>
            <tbody>
              <% @address.violations.order("created_at DESC").each do |violation| %>
                <%= render partial: "shared/violation_table", locals: {violation: violation} %>
              <% end %>
            </tbody>
          </table>
        </div>
        <% else %>
        <p style="text-align: center">No violations have been created for this address.</p>
        <% end %>
      </div>
      <div class="tab-pane fade " id="citation">
        <% if @address_citations.any? %>
        <div class="table-responsive" style="text-align: center">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th scope="col">Citation ID</th>
                <th scope="col">Address</th>
                <th scope="col">Created By</th>
                <th scope="col">Created At</th>
                <th scope="col">Fine</th>
                <th scope="col">Status</th>
                <th scope="col">Code</th>
                <th scope="col">Deadline Date</th>
              </tr>
            </thead>
            <tbody>
              <% @address_citations.each do |citation| %>
                <%= render partial: "shared/citation_table", locals: {citation: citation} %>
              <% end %>
            </tbody>
          </table>
        </div>
        <% end %>
      </div>
      <div class="tab-pane fade" id="inspection">
        <div style="text-align: center">
            <%= link_to "Create New Inspection", new_address_inspection_path(@address), class: "btn btn-primary btn-lg mt-5", data: { turbo: false } %>
        </div>
        <br>
        <% if @address.inspections.any? %>
        <div class="table-responsive" style="text-align: center">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th scope="col">Created At</th>
                <th scope="col">Source</th>
                <th scope="col">Status</th>
                <th scope="col">Scheduled Date</th>
                <th scope="col">Inspector</th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody>
              <% @address.inspections.where(unit: nil).order("updated_at DESC").each do |inspection| %>
                <%= render partial: "shared/inspection_table2", locals: {inspection: inspection} %>
              <% end %>
            </tbody>
          </table>
        </div>
        <% else %>
        <p style="text-align: center">No inspections have been created for this address.</p>
        <% end %>
      </div>
      <div class="tab-pane fade" id="complaint">
        <div style="text-align: center">
          <%= link_to "Create New Complaint", new_address_inspection_path(@address, source: "Complaint"), class: "btn btn-primary btn-lg mt-5", data: { turbo: false } %>
        </div>
        <br>
        <% if @address.inspections.where(source: "Complaint").any? %>
        <div class="table-responsive" style="text-align: center">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th scope="col">Created At</th>
                <th scope="col">Address</th>
                <th scope="col">Type</th>
                <th scope="col">Status</th>
                <th scope="col">Inspector</th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody>
              <% @address.inspections.where(source: "Complaint").order("updated_at DESC").each do |inspection| %>
                <%= render partial: "shared/complaint_table", locals: {inspection: inspection} %>
              <% end %>
            </tbody>
          </table>
        </div>
        <% else %>
        <p style="text-align: center">No complaints have been created for this address.</p>
        <% end %>
      </div>
  </div>
</div>
<div class="row">
  <div class="col">

  </div>
  <div class="col mt-5">
    

  </div>
</div>
