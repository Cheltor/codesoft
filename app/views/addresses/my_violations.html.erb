
<div class="container mt-5">
  <div class="row">
    <div class="col-12">
    <% current_user.name ? (name = current_user.name) : (name = "My") %>
    <h1 style="text-align:center"><%= name %> Violations</h1>
    <br>
    <%= link_to "All Violations", my_violations_path, class:"btn btn-secondary" %>
    <%= link_to "Current", my_violations_path(status: "current"), class:"btn btn-warning" %>
    <%= link_to "Resolved", my_violations_path(status: "resolved"), class:"btn btn-success" %>
      <br>
      <div class="table-responsive">
      <table class="table table-sm table-striped">
        <thead>
          <tr>
            <th>Address</th>
            <th>Type</th>
            <th>Created</th>
            <th>Code(s)</th>
            <th>Deadline</th>
          </tr>
        </thead>
      </div>
      <tbody>
        <% @violations.each do |violation| %>
                  <% if violation.status == "current" %>

          <% if violation.deadline_passed? %>
          <tr class="table-danger">
          <td><%= link_to violation.address.combadd, address_path(violation.address), class: "btn btn-danger" %></td>
          <td><%= link_to violation.violation_type, violation_path(violation), class: "btn btn-danger" %></td>
            <td><%= violation.created_at.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y") %></td>
            <td>
              <% violation.codes.each do |code| %>
                  
              <button class="btn btn-outline-dark" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasTop<%= code.id %>" aria-controls="offcanvasTop"><%= code.name %></button>

              <div class="offcanvas offcanvas-top" tabindex="-1" id="offcanvasTop<%= code.id %>" aria-labelledby="offcanvasTopLabel">
                <div class="offcanvas-header">
                  <h5 id="offcanvasTopLabel"><%= code.name %></h5>
                  <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                  <%= code.description %>
                </div>
              </div>

                <% end %>
            </td>
            <td><%= violation.deadline_date.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y") %></td>
          </tr>
          <% else %>
          <tr class="table-warning">
          <td><%= link_to violation.address.combadd, address_path(violation.address), class: "btn btn-warning" %></td>
          <td><%= link_to violation.violation_type, violation_path(violation), class: "btn btn-warning" %></td>

            <td><%= violation.created_at.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y") %></td>
            <td>
            <% violation.codes.each do |code| %>
                  
              <button class="btn btn-outline-dark" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasTop<%= code.id %>" aria-controls="offcanvasTop"><%= code.name %></button>

              <div class="offcanvas offcanvas-top" tabindex="-1" id="offcanvasTop<%= code.id %>" aria-labelledby="offcanvasTopLabel">
                <div class="offcanvas-header">
                  <h5 id="offcanvasTopLabel"><%= code.name %></h5>
                  <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                  <%= code.description %>
                </div>
              </div>

                <% end %>
            </td>
            <td><%= violation.deadline_date.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y") %></td>
          </tr>
          <% end %>
          <%else%>
          <tr class="table-success">
          <td><%= link_to violation.address.combadd, address_path(violation.address), class: "btn btn-success" %></td>
          <td><%= link_to violation.violation_type, violation_path(violation), class: "btn btn-success" %></td>

            <td><%= violation.created_at.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y") %></td>
            <td>
            <% violation.codes.each do |code| %>
                  
              <button class="btn btn-outline-dark" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasTop<%= code.id %>" aria-controls="offcanvasTop"><%= code.name %></button>

              <div class="offcanvas offcanvas-top" tabindex="-1" id="offcanvasTop<%= code.id %>" aria-labelledby="offcanvasTopLabel">
                <div class="offcanvas-header">
                  <h5 id="offcanvasTopLabel"><%= code.name %></h5>
                  <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                  <%= code.description %>
                </div>
              </div>

                <% end %>
            </td>
            <td><%= violation.deadline_date.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y") %></td>
          </tr>
          <% end %>
        <% end %>
      </tbody>
      </table>
    </div>
  </div>
</div>