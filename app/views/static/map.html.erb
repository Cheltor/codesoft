<style>
  #map {
    height: 100%;
  }
  /* Optional: Makes the sample page fill the window. */
  html, body, .container-fluid {
    height: 100%;
    margin: 0;
    padding: 0;
  }
</style>

<div class="container-fluid" style="width: 100%; height: 100%;">
  <div id="map" style="width: 100%; height: 100%;"></div>
</div>

<script>
window.initMap = function() {
  var map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 38.963272210390286, lng: -76.93172673978854},
    zoom: 15,
    styles: [
      {
        featureType: 'poi',
        stylers: [{ visibility: 'off' }]
      },
      {
        featureType: 'transit',
        elementType: 'labels.icon',
        stylers: [{ visibility: 'off' }]
      }
    ]
  });

  var currentInfoWindow = null; 

  function createMarkerWithInfoWindow(map, position, title, content) {
    var marker = new google.maps.Marker({
      position: position,
      map: map,
      title: title
    });

    marker.addListener('click', function() {
      if (currentInfoWindow) { 
        currentInfoWindow.close();
      }

      var infowindow = new google.maps.InfoWindow({
        content: content
      });
      infowindow.open(map, marker);

      currentInfoWindow = infowindow; 
    });
  }

  <% @addresses.each do |address| %>
    <% if address.latitude.present? && address.longitude.present? %>
      var position = { lat: <%= address.latitude %>, lng: <%= address.longitude %> };
      var title = '<%= j address.combadd %>';
      var content = '<a href="/addresses/' + <%= address.id %> + '">' + '<%= j address.combadd %>' + '</a>';

      createMarkerWithInfoWindow(map, position, title, content);
    <% end %>
  <% end %>
}
</script>


<script async defer src="https://maps.googleapis.com/maps/api/js?key=<%= Rails.application.credentials.google[:api_key] %>&callback=initMap"></script>