<% content_for :title, "Dashboard" %>
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="#">
      <%= link_to "Home", root_path %>
    </a></li>
  </ol>
</nav>

<div class="container-fluid mt-5">
  <div class="row">
    <!-- list of @priority_addresses -->
      <h3>Priority Addresses</h3>
      <h5>Addresses with current violations, unpaid citations, pending trial citations, or pending inspections</h5>
        <% @priority_addresses.each do |address| %>
          <div class="col-sm-2">
            <ul class="list-group mb-3">
                <li class="list-group-item"><strong><%= link_to address.combadd, address_path(address) %></strong></li>
                
                <% if address.violations.current.where(user_id: current_user.id).exists? %>
                  <% if address.violations.current.any? { |violation| violation.deadline_date <= Date.tomorrow } %>
                    <li class="list-group-item bg-warning"><%= pluralize(address.violations.current.where(user_id: current_user.id).count, 'Active Violations') %></li>
                  <% else %>
                    <li class="list-group-item"><%= pluralize(address.violations.current.where(user_id: current_user.id).count, 'Active Violations') %></li>
                  <% end %>
                <% end %>

                
                <% if address.violations.any? { |violation| violation.citations.where(status: ["unpaid"], user_id: current_user.id).exists? } %>
                  <li class="list-group-item"><%= pluralize(address.violations.map { |violation| violation.citations.where(status: ["unpaid"], user_id: current_user.id).count }.sum, 'Unpaid Citations') %></li>
                <% end %>

                <% if address.violations.any? { |violation| violation.citations.where(status: ["pending trial"], user_id: current_user.id).exists? } %>
                  <li class="list-group-item"><%= pluralize(address.violations.map { |violation| violation.citations.where(status: ["pending trial"], user_id: current_user.id).count }.sum, 'Pending Trial Citations') %></li>
                <% end %>

                    <% if address.inspections.where(status: nil, scheduled_datetime: nil, inspector_id: current_user.id).any? %>
                      <li class="list-group-item"><%= pluralize(address.inspections.where(status: nil, scheduled_datetime: nil, inspector_id: current_user.id).count, 'Pending Inspections') %></li>
                    <% end %>

                    <% if address.inspections.where.not(scheduled_datetime: nil).where(status: nil, inspector_id: current_user.id).any? %>
                      <li class="list-group-item"><%= pluralize(address.inspections.where.not(scheduled_datetime: nil).where(status: nil, inspector_id: current_user.id).count, 'Scheduled Inspections') %></li>
                    <% end %>
                </ul>          
          </div>
        <% end %>

  </div>
</div>




