
<div class="container mt-5">
  <div class="row">
    <div class="col-12">
      <h1 style="text-align:center">SIR Violations</h1>
      <div class="row mx-auto">
        <div class="col-4">
            <%= form_tag sir_path, method: :get do %>
              <label for="start_date">Start date:</label>
              <%= date_field_tag "start_date", params[:start_date], class: "form-control" %>

              <label for="end_date">End date:</label>
              <%= date_field_tag "end_date", params[:end_date], class: "form-control" %>

              <%= submit_tag "Filter", class: "btn btn-primary mt-3" %>
            <% end %>
        </div>
      </div>
      <br>

      <% if params[:start_date].present? && params[:end_date].present? %>
        <h2>Violations between <%= params[:start_date] %> and <%= params[:end_date] %> - (<%= @violations.count %> total)</h2>
      <% else %>
        <h2>Violations within the last 2 weeks - (<%= @violations.count %> total)</h2>
      <% end %>

      <br>
      <div class="table-responsive">
      <table class="table table-sm table-striped">
        <thead>
          <tr>
            <th>Address</th>
            <th>Type</th>
            <th>Created</th>
            <th>ONS</th>
            <th>Code(s)</th>
            <th>Deadline</th>
          </tr>
        </thead>
      </div>
      <tbody>
        <% @violations.each do |violation| %>
                  <% if violation.status == "current" %>

          <% if violation.deadline_passed? %>
          <tr class="table-danger">
          <td><%= link_to violation.address.combadd, address_path(violation.address), class: "btn btn-danger" %></td>
          <td><%= violation.violation_type %></td>
            <td><%= violation.created_at.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y") %></td>
            <td><%= violation.user.name %></td>
            <td>
              <% violation.codes.each do |code| %>
                  
                <%= render partial: 'shared/code_def_show', locals: { code: code } %>

                <% end %>
            </td>
            <td><%= violation.deadline_date.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y") %></td>
          </tr>
          <% else %>
          <tr class="table-warning">
          <td><%= link_to violation.address.combadd, address_path(violation.address), class: "btn btn-warning" %></td>
                    <td><%= violation.violation_type %></td>

            <td><%= violation.created_at.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y") %></td>
            <td><%= violation.user.name %></td>
            <td>
            <% violation.codes.each do |code| %>
                  
              <%= render partial: 'shared/code_def_show', locals: { code: code } %>

                <% end %>
            </td>
            <td><%= violation.deadline_date.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y") %></td>
          </tr>
          <% end %>
          <%else%>
          <tr class="table-success">
          <td><%= link_to violation.address.combadd, address_path(violation.address), class: "btn btn-success" %></td>
                    <td><%= violation.violation_type %></td>

            <td><%= violation.created_at.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y") %></td>
            <td><%= violation.user.name %></td>
            <td>
            <% violation.codes.each do |code| %>
                  
              <%= render partial: 'shared/code_def_show', locals: { code: code } %>

                <% end %>
            </td>
            <td><%= violation.deadline_date.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y") %></td>
          </tr>
          <% end %>
        <% end %>
      </tbody>
      </table>
    </div>
  </div>
</div>